# Zeabur RSSHub 一键部署配置
# 保存为 docker-compose.yml，直接覆盖即可
version: "3.8"

services:
  rsshub:
    image: diygod/rsshub:latest
    restart: always
    ports:
      - "1200:1200"
    environment:
      # 基础 & 缓存
      NODE_ENV: production
      CACHE_TYPE: redis
      REDIS_URL: redis://redis:6379
      PUPPETEER_WS_ENDPOINT: ws://browserless:3000
      # 安全：请务必改成你自己的随机字符串
      ACCESS_KEY: zeabur_rsshub_demo_key_change_me
      # 超时
      PUPPETEER_TIMEOUT: 20000
    depends_on:
      redis:
        condition: service_healthy
      browserless:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:1200/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  browserless:
    image: browserless/chrome:latest
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s

  redis:
    image: redis/redis-stack-server:latest
    restart: always
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 5s
